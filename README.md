# Online Bookstore Database

In this case study, I will analyze an online bookstore's database with several tables: Books, Customers, Orders, and Order_Details. I will perform various SQL queries to extract valuable information from the database.

## Database Tables

1. **Books**: Contains information about books.
   - `book_id` (Primary Key)
   - `title`
   - `author`
   - `publication_year`
   - `price`
   - `available_quantity`

2. **Customers**: Contains customer information.
   - `customer_id` (Primary Key)
   - `first_name`
   - `last_name`
   - `email`
   - `registration_date`

3. **Orders**: Contains order details.
   - `order_id` (Primary Key)
   - `customer_id` (Foreign Key)
   - `order_date`
   - `total_amount`

4. **Order_Details**: Contains information about individual book items within each order.
   - `order_id` (Foreign Key)
   - `book_id` (Foreign Key)
   - `quantity`
   - `subtotal`

## Tasks and SQL Queries

1. Retrieve a list of books (book title and author) published in the year 2022.
   ```sql
   SELECT title, author
   FROM Books
   WHERE publication_year = 2022;
   ```

2. Calculate the total revenue generated by the bookstore in the year 2022.
   ```sql
   SELECT SUM(total_amount) AS total_revenue
   FROM Orders
   WHERE YEAR(order_date) = 2022;
   ```

3. Find the top 5 bestselling books (based on the total quantity sold) in descending order.
   ```sql
   SELECT b.title, b.author, SUM(od.quantity) AS total_quantity_sold
   FROM Books b
   JOIN Order_Details od ON b.book_id = od.book_id
   GROUP BY b.title, b.author
   ORDER BY total_quantity_sold DESC
   LIMIT 5;
   ```

4. Determine the customer who made the highest total purchase amount and the total amount they spent.
   ```sql
   SELECT c.first_name, c.last_name, SUM(o.total_amount) AS total_purchase_amount
   FROM Customers c
   JOIN Orders o ON c.customer_id = o.customer_id
   GROUP BY c.first_name, c.last_name
   ORDER BY total_purchase_amount DESC
   LIMIT 1;
   ```

5. Calculate the average price of books published before the year 2010.
   ```sql
   SELECT AVG(price) AS average_price
   FROM Books
   WHERE publication_year < 2010;
   ```

6. Identify the customer(s) who registered in 2023.
   ```sql
   SELECT first_name, last_name
   FROM Customers
   WHERE YEAR(registration_date) = 2023;
   ```

7. Calculate the total number of orders placed in the database.
   ```sql
   SELECT COUNT(*) AS total_orders
   FROM Orders;
   ```

8. Find the book(s) with the lowest available quantity in stock.
   ```sql
   SELECT title, author, MIN(available_quantity) AS lowest_quantity
   FROM Books;
   ```

9. Calculate the total revenue for each year from 2020 to 2022.
   ```sql
   SELECT YEAR(order_date) AS year, SUM(total_amount) AS total_revenue
   FROM Orders
   WHERE YEAR(order_date) BETWEEN 2020 AND 2022
   GROUP BY YEAR(order_date);
   ```

10. Determine the customer(s) with the most orders placed.
    ```sql
    SELECT c.first_name, c.last_name, COUNT(o.order_id) AS total_orders_placed
    FROM Customers c
    JOIN Orders o ON c.customer_id = o.customer_id
    GROUP BY c.first_name, c.last_name
    ORDER BY total_orders_placed DESC;
    ```

## SQL Queries

For detailed SQL queries used to create tables and insert data into the database, please refer to the [SQL Queries File](https://github.com/deepdivewithai/BookStore/blob/main/BookStore%20Database.txt).

# Switching to Django ORM
Now, let's switch to using Django ORM (Object-Relational Mapping) for the same tasks. Below, I'll present the equivalent Django ORM code for these tasks.

1. **Books**: Contains information about books.

![Bookstore](https://github.com/deepdivewithai/BookStore/raw/main/Django%20Bookstore%20Images/Book.png)

2. **Customers**: Contains customer information.

![Bookstore](https://github.com/deepdivewithai/BookStore/raw/main/Django%20Bookstore%20Images/Customer.png)

3. **Orders**: Contains order details.

![Bookstore](https://github.com/deepdivewithai/BookStore/raw/main/Django%20Bookstore%20Images/Order.png)

4. **Order_Details**: Contains information about individual book items within each order.

![Bookstore](https://github.com/deepdivewithai/BookStore/raw/main/Django%20Bookstore%20Images/OrderDetails.png)

# Inserting Fake Data to Populate Models:

1. The script begins by printing a friendly "Hello" message to indicate it's running.

2. It creates fake book data, customer data, order data, and order detail data to simulate a bookstore's database.

3. It efficiently inserts this simulated data into the respective database tables using Django's `bulk_create()` method.

4. Finally, it prints a "Script completed!" message to signal the end of the script.

The script's purpose is to populate the database with sample data for development and testing purposes.

![Bookstore](https://github.com/deepdivewithai/BookStore/raw/main/Django%20Bookstore%20Images/ORM%20Insert%201.png)
![Bookstore](https://github.com/deepdivewithai/BookStore/raw/main/Django%20Bookstore%20Images/ORM%20Insert%202.png)


# Serializers 

1. BooksSerializer: This serializer is responsible for converting Book model instances into JSON format and vice versa. It does this by specifying the model it's associated with and indicating that all fields from the model (fields = '__all__') should be included in the serialized data. So, when we use this serializer, it will include all information about books in the serialized output.

2. CustomerSerializer: Similar to the BooksSerializer, this serializer is for the Customer model. It allows us to serialize customer data, including their first name, last name, email, and registration date.

3. OrderSerializer: The OrderSerializer is designed to handle the serialization of Order model instances. It includes details like the order date and total amount.

4. OrderDetailsSerializer: Lastly, the OrderDetailsSerializer deals with serializing OrderDetail model instances. It includes information about the book items within each order, such as the quantity and subtotal.

![Bookstore](https://github.com/deepdivewithai/BookStore/raw/main/Django%20Bookstore%20Images/Serializers.png)

# Views

1. BooksListView: This view is responsible for handling API requests related to books. It extends the ListCreateAPIView class from Django REST framework, which provides both listing and creating functionality. The queryset attribute is set to fetch all objects from the Book model, and the serializer_class attribute is set to BooksSerializer. This means that when you access the endpoint associated with this view, it can list all books and create new book instances by serializing and deserializing data using the BooksSerializer.

2. CustomerListView: Similar to the BooksListView, this view handles API requests related to customers. It lists all customers and allows the creation of new customer instances using the CustomerSerializer.

3. OrderListView: The OrderListView handles API requests related to orders. It lists all orders and allows the creation of new order instances using the OrderSerializer.

4. OrderDetailListView: Lastly, the OrderDetailListView is responsible for API requests concerning order details. It lists all order details and enables the creation of new order detail instances using the OrderDetailsSerializer.

![Bookstore](https://github.com/deepdivewithai/BookStore/raw/main/Django%20Bookstore%20Images/Views.png)

# Views (Tasks)

In this view, I'm essentially the coordinator for these database-related tasks. I fetch data, perform calculations, and organize the results to be displayed in a web page. The context dictionary helps ensure that the data is properly passed to the template for presentation.

![Bookstore](https://github.com/deepdivewithai/BookStore/raw/main/Django%20Bookstore%20Images/Views(Tasks).png)

# URLS

**How Routing Works with 'http://127.0.0.1:8000/':**

- You start with the base URL of your local Django development server, which is 'http://127.0.0.1:8000/'.

- To access the API, you add the 'api/' part to the URL, making it 'http://127.0.0.1:8000/api/'.

- After that, you append the specific API endpoint you want to access, in this case, 'books/'. So, the complete URL becomes 'http://127.0.0.1:8000/api/books/'.

- When you make a request to 'http://127.0.0.1:8000/api/books/', the routing defined in your Django project directs this URL to the 'BooksListView' view in the 'bookstore' app, which handles requests related to books.

This URL structure is used for accessing the 'books/' API endpoint on your local Django development server. It provides a clear and organized way to interact with different parts of your application when making API requests.

## URLs in Project Folder:

![Bookstore](https://github.com/deepdivewithai/BookStore/raw/main/Django%20Bookstore%20Images/URLS%201.png)

## URLs in App Folder:

![Bookstore](https://github.com/deepdivewithai/BookStore/raw/main/Django%20Bookstore%20Images/URLS%202.png)

# Result:

![Bookstore](https://github.com/deepdivewithai/BookStore/raw/main/Django%20Bookstore%20Images/Result%201.png)
![Bookstore](https://github.com/deepdivewithai/BookStore/raw/main/Django%20Bookstore%20Images/Result%202.png)


## To start this Django project after cloning, you should follow these steps:

1. **Clone the Repository:**
   ```
   git clone https://github.com/deepdivewithai/BookStore.git
   ```

2. **Create a Virtual Environment (Optional but recommended):**
   ```
   python -m venv myenv
   ```

3. **Activate the Virtual Environment (Optional):**
   - On Windows:
     ```
     myenv\Scripts\activate
     ```
   - On macOS and Linux:
     ```
     source myenv/bin/activate
     ```

4. **Install Django:**
   ```
   pip install django
   ```

5. **Navigate to the Project Directory:**
   ```
   cd bookstore_project
   ```

6. **Run Migrations:**
   ```
   python manage.py migrate
   ```

7. **Create a Superuser (for Django Admin):**
   ```
   python manage.py createsuperuser
   ```

8. **Start the Development Server:**
   ```
   python manage.py runserver
   ```

9. **Access the Admin Panel:**
   - Open a web browser and go to: `http://127.0.0.1:8000/admin/`
   - Log in with the superuser credentials you created.

10. **Access the API Endpoints:**
    - Use a tool like Postman or your web browser to make API requests to the defined endpoints, e.g., `http://127.0.0.1:8000/api/books/`, `http://127.0.0.1:8000/api/customers/`, etc.

You're now ready to work with the Django project, interact with the API endpoints, and manage data through the Django admin panel.

